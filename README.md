# ReportBot

## Описание
ReportBot - это комплексная система отчетности для сети кафе, обеспечивающая удобное ведение учета, мониторинг движения товаров и финансовых операций. Система интегрируется с Telegram для оперативного уведомления о новых отчетах.

## Основные функции

Система поддерживает четыре типа отчетов:
1. **Отчеты завершения смены** - учет выручки, расходов и сверка кассы
2. **Ежедневная инвентаризация** - подсчет остатков товаров и ингредиентов
3. **Отчеты приема товаров** - документирование поступающих товаров по категориям
4. **Акты списания/перемещения** - учет списаний и перемещений между точками

## Технический стек

- **Бэкенд**: FastAPI, SQLAlchemy, Alembic, PostgreSQL
- **Фронтенд**: React, Tailwind CSS, Vite
- **Инфраструктура**: Docker, Docker Compose
- **Интеграции**: Telegram Bot API

## Установка и запуск

### Требования
- Docker
- Docker Compose

### Быстрый старт
1. Клонировать репозиторий
   ```bash
   git clone https://github.com/yourusername/reportBot.git
   cd reportBot
   ```

2. Создать файл окружения на основе примера
   ```bash
   cp .env.example .env
   ```

3. Отредактировать `.env` файл, добавив необходимые параметры:
   - Настройки базы данных (или оставить значения по умолчанию)
   - Токен Telegram бота
   - ID чата Telegram для отправки уведомлений

4. Запустить проект
   ```bash
   docker-compose up -d
   ```

5. Доступ к системе:
   - Веб-интерфейс: `http://localhost:3000`
   - API: `http://localhost:8000`
   - Документация API: `http://localhost:8000/docs`

## Структура проекта

```
reportBot/
├── backend/                 # Серверная часть приложения
│   ├── app/                 # Основной код бэкенда
│   │   ├── alembic/         # Миграции базы данных
│   │   ├── api/             # API эндпоинты
│   │   ├── core/            # Ядро приложения (конфигурация, константы)
│   │   ├── crud/            # Операции с базой данных
│   │   ├── models/          # Модели базы данных
│   │   ├── schemas/         # Pydantic схемы
│   │   └── services/        # Вспомогательные сервисы
│   ├── Dockerfile           # Dockerfile для бэкенда
│   └── pyproject.toml       # Зависимости и конфигурация Poetry
├── frontend/                # Клиентская часть приложения
│   ├── src/                 # Исходный код React
│   │   ├── constants.js     # Константы приложения (локации)
│   │   └── App.jsx          # Основной компонент приложения
│   ├── Dockerfile           # Dockerfile для фронтенда
│   └── package.json         # Зависимости и скрипты NPM
├── docker-compose.yml       # Конфигурация Docker Compose
├── .env.example             # Пример файла окружения
└── README.md                # Документация проекта
```

## Настройка локаций

Список доступных локаций настраивается в следующих файлах:

1. **Бэкенд**: `backend/app/core/constants.py`
   ```python
   LOCATIONS = [
       "Гагарина 48/1",
       "Абдулхакима Исмаилова 51",
       "Гайдара Гаджиева 7Б"
   ]
   ```

2. **Фронтенд**: `frontend/src/constants.js`
   ```javascript
   export const LOCATIONS = [
     'Гагарина 48/1',
     'Абдулхакима Исмаилова 51',
     'Гайдара Гаджиева 7Б'
   ];
   ```

При необходимости добавления или изменения локаций, обновите оба файла для обеспечения согласованности.

## Настройка Telegram уведомлений

1. Создайте бота через @BotFather в Telegram и получите токен
2. Добавьте бота в групповой чат, где будут появляться уведомления
3. Получите ID чата (можно использовать @getidsbot)
4. Обновите следующие параметры в `.env` файле:
   ```
   TELEGRAM_BOT_TOKEN=ваш_токен_бота
   TELEGRAM_CHAT_ID=ид_группового_чата
   ```

5. Для настройки тем (топиков) укажите их ID:
   ```
   GAGARINA_48_TOPIC_ID=id_топика_для_Гагарина_48/1
   ABDULHAMID_51_TOPIC_ID=id_топика_для_Абдулхакима_Исмаилова_51
   GAIDAR_7B_TOPIC_ID=id_топика_для_Гайдара_Гаджиева_7Б
   ```

## Разработка

### Внесение изменений в бэкенд
1. Отредактируйте файлы в директории `backend/app/`
2. Изменения автоматически применятся благодаря режиму hot-reload

### Внесение изменений во фронтенд
1. Отредактируйте файлы в директории `frontend/src/`
2. Изменения автоматически применятся благодаря режиму hot-reload

### Миграции базы данных
При изменении моделей данных создайте новую миграцию:
```bash
docker-compose exec backend bash -c "cd app && poetry run alembic revision --autogenerate -m 'описание изменений'"
```

## Работа с API

Документация API доступна по адресу `http://localhost:8000/docs` после запуска приложения.

### Основные эндпоинты:

- `POST /shift-reports/create` - создание отчета завершения смены
- `POST /daily_inventory/create` - создание ежедневной инвентаризации
- `POST /report-on-goods/create` - создание отчета о приеме товаров
- `POST /writeoff-transfer/create` - создание акта списания/перемещения

## Устранение неполадок

### Проблема: Приложение не запускается
1. Убедитесь, что порты 3000, 8000 и 5432 не заняты другими приложениями
2. Проверьте логи контейнеров:
   ```bash
   docker-compose logs
   ```

### Проблема: Отчеты не отправляются в Telegram
1. Проверьте правильность токена бота и ID чата
2. Убедитесь, что бот имеет права на отправку сообщений в группу
3. Проверьте логи бэкенда:
   ```bash
   docker-compose logs backend
   ```

### Проблема: Ошибки миграций базы данных
1. Проверьте логи бэкенда при запуске
2. Для сброса базы данных (⚠️ все данные будут потеряны):
   ```bash
   docker-compose down -v
   docker-compose up -d
   ```

## Лицензия

Проект распространяется под [MIT лицензией](LICENSE).

## Поддержка

При возникновении вопросов или проблем, пожалуйста, создайте issue в репозитории проекта.

---

**Примечание**: Документация актуальна на июнь 2025 года. При внесении существенных изменений в систему, рекомендуется обновить документацию.